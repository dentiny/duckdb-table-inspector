# name: test/sql/inspect_database/inspect_database.test
# description: test inspect_database function with persistent databases
# group: [inspect_database]

require table_inspector

# Create and use a persistent database file
statement ok
ATTACH '__TEST_DIR__/test_inspect.duckdb' AS testdb;

statement ok
USE testdb;

# Empty database should return 0 rows
query I
SELECT COUNT(*) FROM inspect_database();
----
0

# Create some tables
statement ok
CREATE TABLE tbl1 (id int);

statement ok
CREATE TABLE tbl2 (txt varchar);

# It should find all user-created tables in the main schema
query T
SELECT table_name FROM inspect_database() ORDER BY table_name;
----
tbl1
tbl2

# It should not list tables from internal schemas
query I
SELECT COUNT(*) FROM inspect_database() WHERE schema_name = 'information_schema';
----
0

# It should find tables in custom schemas
statement ok
CREATE SCHEMA s1;

statement ok
CREATE TABLE s1.tbl3 (id int);

query TT
SELECT schema_name, table_name FROM inspect_database() WHERE schema_name = 's1';
----
s1	tbl3

# Verify that we can query all columns successfully
query I
SELECT COUNT(*) FROM (
    SELECT database_name, schema_name, table_name, persisted_data_size
    FROM inspect_database()
);
----
3

# Verify database_name is correct
query T
SELECT DISTINCT database_name FROM inspect_database();
----
testdb

# Cleanup
statement ok
USE memory;

statement ok
DETACH testdb;
