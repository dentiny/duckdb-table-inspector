# name: test/sql/inspect_database/inspect_database_accuracy.test
# description: Test accuracy of inspect_database() size estimation
# group: [inspect_database]

require table_inspector

# Use a persistent database file to test storage
statement ok
ATTACH '__TEST_DIR__/inspect_accuracy.db' AS testdb;

statement ok
USE testdb;

# Table data size updates immediately after CHECKPOINT
statement ok
CREATE TABLE test_data (id INTEGER, name VARCHAR);

# Before INSERT: empty table has 0 persisted_data_bytes
query I
SELECT persisted_data_bytes FROM inspect_database() WHERE table_name = 'test_data';
----
0

statement ok
INSERT INTO test_data SELECT i, 'name_' || i FROM range(10000) t(i);

statement ok
CHECKPOINT;

# After CHECKPOINT: data is on disk, persisted_data_bytes should be non-zero
query I
SELECT persisted_data_bytes > 0 FROM inspect_database() WHERE table_name = 'test_data';
----
true
